<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aesthetic Photobooth</title>
    <!-- Font Retro -->
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #ffecd1;
            --booth-color: #fcb69f;
            --accent: #ff6b6b;
            --text: #555;
        }

        

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(#ff6b6b 1px, transparent 1px);
            background-size: 20px 20px;
            font-family: 'Patrick Hand', cursive;
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            font-family: 'VT323', monospace;
            font-size: 3rem;
            color: white;
            text-shadow: 3px 3px 0px var(--accent);
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        /* --- BOOTH CONTAINER --- */
        .booth-container {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            position: relative;
            text-align: center;
            border: 8px solid white;
            outline: 2px dashed var(--accent);
        }

        
/* STICKER TIMBUL DI LUAR FRAME */
.sticker-out {
    position: absolute;
    width: 120px;
    opacity: 0.95;
    pointer-events: none;
    z-index: 20; /* di atas frame */
}

/* KIRI ATAS KELUAR */
.sticker-out.left {
    top: -40px;
    left: -40px;
}

/* KANAN BAWAH KELUAR */
.sticker-out.right {
    bottom: -40px;
    right: -40px;
}

        /* --- SCREEN / VIEWPORT --- */
        .viewport {
            width: 100%;
            height: 400px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
            border: 4px solid #333;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror effect */
        }

        /* --- FLASH EFFECT --- */
        .flash {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 10;
        }

        @keyframes flashAnim {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* --- COUNTDOWN OVERLAY --- */
        .countdown-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'VT323', monospace;
            font-size: 8rem;
            color: white;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 5;
            display: none;
        }

        /* --- CONTROLS --- */
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .btn {
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        .btn:active { transform: translateY(2px); box-shadow: none; }

        .btn-capture {
            background: var(--accent);
            color: white;
            width: 100%;
            max-width: 200px;
        }

        .btn-filter {
            background: #eee;
            color: #555;
        }

        .btn-filter.active {
            background: var(--booth-color);
            color: white;
            font-weight: bold;
        }

        /* --- PHOTO STRIP RESULT --- */
        #result-area {
            margin-top: 30px;
            display: none; /* Hidden until photos taken */
            animation: slideUp 0.5s ease;
        }

        .photo-strip {
            background: white;
            padding: 15px 15px 40px 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 300px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transform: rotate(-2deg);
            position: relative;
        }

        .photo-strip img {
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            filter: contrast(1.1) brightness(1.1);
        }

        .strip-footer {
            text-align: center;
            font-family: 'VT323', monospace;
            color: #333;
            font-size: 1.2rem;
            margin-top: 5px;
            border-top: 1px dashed #ccc;
            padding-top: 5px;
        }
        

        .download-btn {
            margin-top: 20px;
            background: #333;
            color: white;
            text-decoration: none;
            padding: 10px 30px;
            border-radius: 5px;
            display: inline-block;
        }

        /* Canvas hidden for processing */
        canvas { display: none; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 500px) {
            .viewport { height: 300px; }
            h1 { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

    <h1>PHOTOBOOTH <span style="font-size:0.5em">â™¥</span></h1>

    
    <!-- MUSIC VIA LINK -->
    <audio id="bgm" loop>
    <source src="https://github.com/SpriiXp/jatuh/blob/main/Nadhif%20Basalamah%20-%20kota%20ini%20tak%20sama%20tanpamu%20(Official%20Lyric%20Video)%20-%20nadhif%20basalamah.mp3" type="audio/mpeg">
</audio>


    <div class="booth-container">

    <!-- STICKER TIMBUL -->
    <img src="sep.PNG" class="sticker-out left">
    <img src="yol.PNG" class="sticker-out right">

    <!-- VIEWPORT -->
    <div class="viewport">
        <video id="webcam" autoplay playsinline></video>
        <div class="flash" id="flash"></div>
        <div class="countdown-overlay" id="countdown">3</div>
    </div>

    <!-- CONTROLS -->
    <div class="controls">
        <button class="btn btn-filter active" onclick="setFilter('none', this)">Normal</button>
        <button class="btn btn-filter" onclick="setFilter('sepia(0.8)', this)">Retro</button>
        <button class="btn btn-filter" onclick="setFilter('grayscale(1)', this)">B&W</button>
    </div>

    <button class="btn btn-capture" id="startBtn" onclick="startSession()">
        <i class="fas fa-camera"></i> AMBIL FOTO (4x)
    </button>

</div>

    <div id="result-area">
        <div class="photo-strip" id="strip">
            <!-- Foto akan masuk sini otomatis -->
            <div class="strip-footer">Memories</div>
        </div>
        <br>
        <a href="#" class="download-btn" id="downloadLink" download="photobooth-strip.png">
            <i class="fas fa-download"></i> DOWNLOAD STRIP
        </a>
        <br><br>
        <button class="btn btn-filter" onclick="resetBooth()">Ulangi Foto</button>
    </div>

    <!-- Canvas invisible buat proses gambar -->
    <canvas id="canvas"></canvas>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const flash = document.getElementById('flash');
        const countdownEl = document.getElementById('countdown');
        const stripContainer = document.getElementById('strip');
        const resultArea = document.getElementById('result-area');
        const startBtn = document.getElementById('startBtn');
        
        let currentFilter = 'none';
        let photos = [];
        let isSessionActive = false;

        // 1. AKSES KAMERA
        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user", width: { ideal: 1280 }, height: { ideal: 720 } } 
                });
                video.srcObject = stream;
            } catch (err) {
                alert("Maaf, tidak bisa mengakses kamera. Pastikan izin kamera aktif!");
                console.error(err);
            }
        }
        initCamera();

        // 2. GANTI FILTER
        function setFilter(filterVal, btn) {
            currentFilter = filterVal;
            video.style.filter = filterVal;
            
            // Update tombol aktif
            document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // 3. PROSES FOTO (4x)
        async function startSession() {
            if(isSessionActive) return;
            isSessionActive = true;
            startBtn.disabled = true;
            startBtn.innerText = "SEDANG MEMOTRET...";
            photos = [];
            stripContainer.innerHTML = '<div class="strip-footer">Loading...</div>'; // Reset
            resultArea.style.display = 'none';

            // Loop 4 kali
            for(let i=1; i<=4; i++) {
                await countdown();
                takePhoto();
                // Jeda antar foto biar gak kaget
                if(i < 4) await wait(1500); 
            }

            generateStrip();
            isSessionActive = false;
            startBtn.disabled = false;
            startBtn.innerText = "<i class='fas fa-camera'></i> AMBIL FOTO (4x)";
        }

        // 4. HITUNG MUNDUR
        function countdown() {
            return new Promise(resolve => {
                let count = 3;
                countdownEl.style.display = 'flex';
                countdownEl.innerText = count;
                
                const timer = setInterval(() => {
                    count--;
                    if(count > 0) {
                        countdownEl.innerText = count;
                    } else {
                        clearInterval(timer);
                        countdownEl.innerText = "CHEESE!";
                        setTimeout(() => {
                            countdownEl.style.display = 'none';
                            resolve();
                        }, 500);
                    }
                }, 1000);
            });
        }

        // 5. JEPRET!
        function takePhoto() {
            // Efek Flash
            flash.style.animation = 'none';
            flash.offsetHeight; /* trigger reflow */
            flash.style.animation = 'flashAnim 0.2s ease-out';

            // Set ukuran canvas sesuai video asli
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // Terapkan Filter ke Canvas
            ctx.filter = currentFilter;
            
            // Gambar video ke canvas (Mirror horizontal biar sesuai mirror)
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Reset transform biar gak numpuk
            ctx.setTransform(1, 0, 0, 1, 0, 0); 

            // Simpan hasil
            const dataUrl = canvas.toDataURL('image/png');
            photos.push(dataUrl);
        }

        // 6. HASILKAN STRIP
        function generateStrip() {
            stripContainer.innerHTML = '';
            
            // Masukkan 4 foto ke div strip
            photos.forEach(photo => {
                const img = document.createElement('img');
                img.src = photo;
                stripContainer.appendChild(img);
            });

            // Tambah footer tanggal
            const date = new Date();
            const footer = document.createElement('div');
            footer.className = 'strip-footer';
            footer.innerText = date.toLocaleDateString() + " // US";
            stripContainer.appendChild(footer);

            // Tampilkan area hasil
            resultArea.style.display = 'block';
            
            // Scroll ke hasil
            resultArea.scrollIntoView({ behavior: 'smooth' });
        }

        // 7. DOWNLOAD (Gabung semua foto ke 1 gambar besar)
        // Agar downloadnya jadi 1 file gambar panjang
        document.getElementById('downloadLink').addEventListener('click', function(e) {
            e.preventDefault();
            
            // Buat canvas besar buat strip
            const stripCanvas = document.createElement('canvas');
            const stripCtx = stripCanvas.getContext('2d');
            const width = 300; // Lebar strip
            const height = 450; // Tinggi total strip (perkiraan)
            
            stripCanvas.width = width;
            stripCanvas.height = height;

            // Background putih
            stripCtx.fillStyle = '#ffffff';
            stripCtx.fillRect(0,0, width, height);

            // Loop gambar ke canvas besar
            // Kita load gambar dulu baru gambar ke canvas
            let loaded = 0;
            
            photos.forEach((src, index) => {
                const img = new Image();
                img.onload = () => {
                    // Gambar foto
                    // Y position: 20 padding atas + (index * 90 tinggi foto)
                    const yPos = 20 + (index * 95);
                    const imgHeight = 90;
                    
                    stripCtx.drawImage(img, 15, yPos, width-30, imgHeight);
                    
                    loaded++;
                    if(loaded === photos.length) {
                        // Tambah Teks
                        stripCtx.fillStyle = '#333';
                        stripCtx.font = '20px Courier New';
                        stripCtx.textAlign = 'center';
                        stripCtx.fillText(new Date().toLocaleDateString(), width/2, height - 20);

                        // Trigger Download
                        const link = document.createElement('a');
                        link.download = 'photobooth-strip.png';
                        link.href = stripCanvas.toDataURL();
                        link.click();
                    }
                };
                img.src = src;
            });
        });

        function resetBooth() {
            resultArea.style.display = 'none';
            startBtn.scrollIntoView({ behavior: 'smooth' });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

    document.body.addEventListener('click', function () {
    document.getElementById('bgm').play();
});

    </script>
</body>
</html>
